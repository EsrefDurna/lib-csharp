# Babel Error Handling #

By default Babel services have a standard error handling implementation. It may be overridden, but it is not advised. In case if an error will be generated by a service the Babel MVC framework will return a protocol specific error code and a ServiceError object data.

The default Babel protocol is HTTP which will returns following HTTP status codes:

| **HTTP Status** | **Condition when returned**                              |
|-----------------|----------------------------------------------------------|
| 200             | No error                                                 |
| 400             | Error in the request data, for example validation issues |
| 500             | Internal service error, for example database timeout     |

`ServiceError` data is a standard way to return information about the error condition for a Babel service, it may contain following information:

-   `Time` – date and time when error happened. We encourage to use UTC time
-   `Tags` – optional strings to help categorizing the error   
-   `Context` - optional additional error details (user identifier, request identifier, etc)
-   `Details` – human readable errors details/message in English
-   `Inner` – optional nested server error
    -   `Errors` – one or more detailed error condition descriptions
    -   `Code`<sup>\*</sup> – error code identifying error situation (e.g. VALIADATION\_ERROR)
    -   `Params`<sup>\*</sup> –provide error condition specifics (e.g. name of the fields that didn’t pass the validation)
    -   `Message` – human readable error message. One can use format strings with {0}…{n} placeholders that will be replaces with Params in the result error message sent to a client
    
  		<sup>\*</sup> - combination of `Code` and `Params` can be used by a client to create localized error message

##Babel Error Codes##
It is up to a service developer to define service specific error codes. Few codes are used by the Babel framework

-   `INVALID_JSON` – request type is JSON and request cannot be deserialized
-   `INVALID_XML`– request type is XML and request cannot be deserialized
-   `VALIDATION_ERROR` – error thrown by a validation routine
-   `INVALID_REQUEST` – other problem with received request. This code is automatically set for `ArgumentException` , `ApplicationException` or `NotImplementedException`
-   `INTERNAL_ERROR` – other unhandled exceptions not implementing `IBabelException`

A service developer can map exceptions to service error by:

-   Using `ServiceApplicationException` or `BabelException`
-   Creating exception that implements `IBabelException` interface
-   Mapping existing exception types by overriding `TranslateError(…)` method in the controller class

##Validation in Babel##
Babel controller or model doesn’t validate data received, but there is an easy way to do it: `IBabelModel` implemented by all models generated by Babel in .Net has `Validate` extension methods defined in `BabelRpc.BabelModelExtensions` class. There are two methods for validation:

 This will throw `BabelValidionException` on validation error:

	modelData.Validate();

This will return Boolean (false on validation error\[s\]):

    List&lt;ValidationResult&gt; errors;
    if (!modelData.Validate(out errors))
    {
    //process validation errors
    }

This validation uses the standard `System.ComponentModel.DataAnnotations` validation attributes (<https://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations%28v=vs.110%29.aspx>)

Please note that MS validator doesn’t perform deep validation – it validates only top level object. `BabelRpc.BabelModelExtensions.Validate(...)` validates the entire object hierarchy.

The validation attributes can be added to .babel model by using scoped attributes:
 
	@cs[System.ComponentModel.DataAnnotations.Range(1980, 2100)]
	int16 ExpirationYear;

##Other useful Babel model extensions##

`BabelRpc.BabelModelExtensions` also provides following useful `IBabelModel` extensions:

Model comparison:

-   `bool Compare(this IBabelModel obj, IBabelModel value)`
-   `bool Compare(this IBabelModel obj, IBabelModel value, out string path)` - outputs the first found model member that is different

Deep copy of the model – clones the entire model hierarchy

-   `IBabelModel DeepCopy(**this** IBabelModel obj)`

Please note that `BabelRpc.BabelModelExtensions` doesn’t use reflections, leveraging `IBabelModel` `RunOnChildren` and `RunOnChild` methods instead.
